<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch√∫c M·ª´ng Sinh Nh·∫≠t!</title>
    <link ref="stylesheet" href="styles.css">
    <style>
        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);
            font-family: 'Arial', sans-serif;
            overflow-x: hidden;
            text-align: center;
        }

        .title {
            font-size: 4em;
            color: #ff6b81;
            margin: 20px 0;
            font-family: 'Dancing Script', cursive;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .countdown {
            font-size: 3em;
            color: #ff4081;
            margin: 20px 0;
            transition: all 1s ease-in-out;
        }

        .countdown span {
            color: #ff6b81;
            font-weight: bold;
        }

        .birthday-content {
            display: none;
            animation: fadeIn 2s ease-out;
        }

        .cake-container {
            width: 300px;
            height: 300px;
            margin: 30px auto;
            position: relative;
        }

        .candle {
            width: 10px;
            height: 30px;
            background: #fff;
            position: absolute;
            bottom: 290px;
            left: 145px;
        }

        .flame {
            width: 20px;
            height: 30px;
            background: #ffeb3b;
            border-radius: 50% 50% 20% 20%;
            position: absolute;
            bottom: 320px;
            left: 140px;
            animation: flicker 1s infinite;
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        @keyframes flicker {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .birthday-message {
            font-size: 4em;
            color: #ff4081;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin: 30px 0;
            font-family: 'Dancing Script', cursive;
            display: none;
            animation: popIn 1.5s ease-out;
        }

        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        .controls {
            margin: 20px 0;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 20px;
            background: #ff4081;
            color: white;
            cursor: pointer;
            font-size: 1em;
            transition: transform 0.2s;
        }

        button:hover {
            transform: scale(1.05);
        }

        #blowProgress {
            width: 0%;
            height: 20px;
            background-color: #ff4081;
            transition: width 0.3s;
            border-radius: 10px;
            text-align: center;
            color: white;
            line-height: 20px;
        }

        .progress-container {
            width: 200px;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            margin: 20px auto;
            overflow: hidden;
        }

        #audioFeedback {
            display: none;
            margin: 10px auto;
        }
    </style>
</head>
<body>
    <div class="title">ƒê·∫æM NG∆Ø·ª¢C</div>
    
    <div class="countdown" id="countdown">
        <span id="days">312</span> ng√†y 
        <span id="hours">1</span> gi·ªù 
        <span id="minutes">42</span> ph√∫t 
        <span id="seconds">19</span> gi√¢y
    </div>

    <div class="birthday-content" id="birthdayContent">
        <div class="birthday-message" id="birthdayMessage">
            Ch√∫c M·ª´ng Sinh Nh·∫≠t! üéâ
        </div>

        <div class="cake-container">
            <svg class="cake" viewBox="0 0 200 100" xmlns="http://www.w3.org/2000/svg">
                <ellipse cx="100" cy="95" rx="90" ry="5" fill="#d1d1d1" />
                <path d="M30,95 C30,75 170,75 170,95" fill="#f9a4cb" />
                <path d="M45,75 C45,58 155,58 155,75" fill="#feb8da" />
                <path d="M60,58 C60,45 140,45 140,58" fill="#ffcce5" />
                <path d="M30,95 C30,89 170,89 170,95" fill="#ffffff" />
                <path d="M45,75 C45,70 155,70 155,75" fill="#ffffff" />
                <path d="M60,58 C60,54 140,54 140,58" fill="#ffffff" />
                <circle cx="50" cy="82" r="3" fill="#ff6666" />
                <circle cx="80" cy="82" r="3" fill="#66ff66" />
                <circle cx="110" cy="82" r="3" fill="#6666ff" />
                <circle cx="140" cy="82" r="3" fill="#ffff66" />
                <circle cx="65" cy="65" r="3" fill="#ff6666" />
                <circle cx="95" cy="65" r="3" fill="#66ff66" />
                <circle cx="125" cy="65" r="3" fill="#6666ff" />
            </svg>
            <div class="candle" id="candle"></div>
            <div class="flame" id="flame"></div>
        </div>

        <div class="controls">
            <button id="micPermissionBtn">Cho ph√©p s·ª≠ d·ª•ng microphone</button>
            <button id="blowButton" style="display: none;">Th·ªïi n·∫øn!</button>
        </div>

        <canvas id="audioFeedback" width="300" height="60"></canvas>
        
        <div class="progress-container" id="progressContainer" style="display: none;">
            <div id="blowProgress">0%</div>
        </div>
    </div>

    <script>
        // Set your birthday here (month is 0-indexed: 0 = January, 11 = December)
        const birthdayMonth = 11;  // December
        const birthdayDay = 25;   // 25th

        function updateCountdown() {
            const now = new Date();
            let birthday = new Date(now.getFullYear(), birthdayMonth, birthdayDay);
            
            if (now > birthday) {
                birthday = new Date(now.getFullYear() + 1, birthdayMonth, birthdayDay);
            }

            const diff = birthday - now;
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            document.getElementById('days').textContent = days;
            document.getElementById('hours').textContent = hours;
            document.getElementById('minutes').textContent = minutes;
            document.getElementById('seconds').textContent = seconds;

            // Check if it's birthday
            if (now.getMonth() === birthdayMonth && now.getDate() === birthdayDay) {
                showBirthdayContent();
            }
        }

        function showBirthdayContent() {
            document.querySelector('.title').style.display = 'none';
            document.getElementById('countdown').style.display = 'none';
            document.getElementById('birthdayContent').style.display = 'block';
            document.getElementById('birthdayMessage').style.display = 'block';
            document.querySelector('.cake-container').style.display = 'block';

            // Change background
            document.body.style.background = 'linear-gradient(135deg, #ffe6eb 0%, #ffb8c6 100%)';
            
            // Add animation to the message
            document.getElementById('birthdayMessage').style.animation = 'popIn 1.5s ease-out';
        }

        // Blow detection code and candle animation
        let blowProgress = 0;
        let audioContext, analyser, microphone;

        document.getElementById('micPermissionBtn').addEventListener('click', async function() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                audioContext = new AudioContext();
                microphone = audioContext.createMediaStreamSource(stream);
                analyser = audioContext.createAnalyser();
                
                microphone.connect(analyser);
                
                const dataArray = new Uint8Array(analyser.frequencyBinCount);
                
                this.style.display = 'none';
                document.getElementById('blowButton').style.display = 'inline-block';
                document.getElementById('audioFeedback').style.display = 'block';
                document.getElementById('progressContainer').style.display = 'block';
                
                function checkBlow() {
                    analyser.getByteFrequencyData(dataArray);
                    const blowStrength = dataArray.reduce((a, b) => a + b) / dataArray.length;
                    
                    if (blowStrength > 15) {
                        blowProgress += (blowStrength / 100);
                        blowProgress = Math.min(blowProgress, 100);
                        
                        document.getElementById('blowProgress').style.width = blowProgress + '%';
                        document.getElementById('blowProgress').textContent = Math.round(blowProgress) + '%';
                        
                        if (blowProgress >= 100) {
                            document.getElementById('flame').style.opacity = '0';
                            stopBlowDetection();
                        }
                    }
                    
                    requestAnimationFrame(checkBlow);
                }
                
                checkBlow();
            } catch (err) {
                console.error('Kh√¥ng th·ªÉ truy c·∫≠p microphone:', err);
                alert('Kh√¥ng th·ªÉ truy c·∫≠p microphone. H√£y th·ª≠ l·∫°i.');
            }
        });

        function stopBlowDetection() {
            if (microphone) microphone.disconnect();
            if (analyser) analyser.disconnect();
            if (audioContext) audioContext.close();
            
            document.getElementById('blowButton').style.display = 'none';
            document.getElementById('audioFeedback').style.display = 'none';
            document.getElementById('progressContainer').style.display = 'none';
            
            document.getElementById('birthdayMessage').innerHTML = 
                'Ch√∫c m·ª´ng sinh nh·∫≠t! üéâ<br>B·∫°n ƒë√£ th·ªïi t·∫Øt n·∫øn th√†nh c√¥ng!<br>Hy v·ªçng m·ªçi ƒëi·ªÅu ∆∞·ªõc c·ªßa b·∫°n s·∫Ω th√†nh hi·ªán th·ª±c!';
        }

        // Start countdown when page loads
        updateCountdown();
        setInterval(updateCountdown, 1000);
    </script>
</body>
</html>